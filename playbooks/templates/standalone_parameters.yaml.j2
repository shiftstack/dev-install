#vi:syntax=yaml

parameter_defaults:
  CloudName: {{ hostname }}.{{ clouddomain }}
  ContainerCli: podman
  Debug: true
  DeploymentUser: {{ ansible_env.USER }}
  DnsServers:
{% for nameserver in network_info.dns %}
    - {{ nameserver }}
{% endfor %}
  # needed for vip & pacemaker
  KernelIpNonLocalBind: 1
  DockerInsecureRegistryAddress:
    - {{ control_plane_ip }}:8787
  # domain name used by the host
  CloudDomain: {{ clouddomain }}
  NeutronDnsDomain: {{ clouddomain }}
  NeutronBridgeMappings: {{ neutron_bridge_mappings }}
  NeutronFlatNetworks: {{ neutron_flat_networks }}
{% if sriov_interface is defined %}
  NeutronPhysicalDevMappings: "hostonly:{{ sriov_interface }}"
  NovaPCIPassthrough: {{sriov_nova_pci_passthrough | mandatory | to_json }}
{% endif %}
{% if dpdk_kernel_args is defined %}
  KernelArgs: "{{ dpdk_kernel_args | mandatory }}"
  IsolCpusList: "{{ dpdk_isol_cpus_list | mandatory }}"
  NovaComputeCpuDedicatedSet: "{{ dpdk_isol_cpus_list | mandatory }}"
  NovaComputeCpuSharedSet: "{{ dpdk_cpu_shared_set | mandatory }}"
  TunedProfileName: cpu-partitioning
{% endif %}
  StandaloneEnableRoutedNetworks: false
  StandaloneHomeDir: "{{ ansible_env.HOME }}"
  InterfaceLocalMtu: 1500
  SELinuxMode: permissive
  # For OSP17+:
  StandaloneNetworkConfigTemplate: "{{ ansible_env.HOME }}/dev-install_net_config.yaml"
  # For OSP16:
  StandaloneNetConfigOverride:
    network_config:
{% for member in net_config_json['network_config'] %}
      - {{ member }}
{% endfor %}
  OctaviaGenerateCerts: true
  OctaviaCaKeyPassphrase: "secrete"
  OctaviaAmphoraSshKeyFile: "{{ ansible_env.HOME }}/octavia.pub"
  OctaviaAmphoraImageFilename: "{{ ansible_env.HOME }}/amphora.qcow2"
  # We never want the node to reboot during tripleo deploy, but defer to later
  StandaloneExtraGroupVars:
    tripleo_kernel_defer_reboot: true
{% if ceph_enabled %}
{% if ceph_devices is defined %}
  CephAnsibleDisksConfig:
    osd_scenario: lvm
    osd_objectstore: bluestore
    devices:
{% for device in ceph_devices %}
    - {{ device }}
{% endfor %}
  NovaEnableRbdBackend: true
{% else %}
  CephAnsibleDisksConfig:
    osd_scenario: lvm
    osd_objectstore: bluestore
    lvm_volumes:
      - data: data-lv2
        data_vg: vg2
        db: db-lv2
        db_vg: vg2
  # Since we use a loop device for Ceph disk, performances wouldn't be great enough
  # to boot VMs with heavy workloads on it.
  # This can be overriden by setting:
  # extra_heat_params:
  #   NovaEnableRbdBackend: true
  # But to use at your own risks.
  NovaEnableRbdBackend: false
{% endif %}
  CephAnsibleExtraConfig:
    cluster_network: {{ network_info.public_ipv4.network }}/{{ network_info.public_ipv4_cidr }}
    public_network: {{ network_info.public_ipv4.network }}/{{ network_info.public_ipv4_cidr }}
  CephPoolDefaultPgNum: 8
  CephPoolDefaultSize: 1
{% endif %}
{% if ssl_enabled %}
  AddVipsToEtcHosts: true
  HorizonSecureCookies: True
  SSLCertificate: |
    {{ ssl_cert | indent }}
  SSLKey: |
    {{ ssl_key | indent }}
  SSLRootCertificate: |
    {{ ssl_ca_cert | indent }}
  PublicTLSCAFile: {{ ssl_ca_cert_path }}
{% endif %}
{% if standalone_extra_config|length > 0 %}
  StandaloneExtraConfig:
{% for key, value in standalone_extra_config.items() %}
    {{ key }}: {{ value }}
{% endfor %}
{% endif %}
{# note: keep this block at the very end #}
{% if extra_heat_params is defined %}
{% for key, value in extra_heat_params.items() %}
  {{ key }}: {{ value }}
{% endfor %}
{% endif %}
